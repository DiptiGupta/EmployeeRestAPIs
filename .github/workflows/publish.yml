name: Publish package to GitHub Packages
on:
  release:
    types: [released]
  workflow_dispatch:
    inputs:
      version:
        description: "version (format: '^[0-9]+.[0-9]+.[0-9]$') e.g. '1.0.21' (package name will be '<version>-rc-yyyyMMddHHmm')"
        required: true

jobs:
  publish:
    runs-on: ubuntu-latest
    steps:
      - name: checkout
        uses: actions/checkout@v3
      - name: Fetch tags
        id: fetch_tag
        run: |
         git fetch --tags 
         echo LATEST_TAG=$(git describe --abbrev=0 --tags `git rev-list --tags --max-count=1`) >> $GITHUB_OUTPUT
         echo $(git describe --abbrev=0 --tags `git rev-list --tags --max-count=1`)
         echo $(git describe --abbrev=0 --tags `git rev-list --tags --skip=1 --max-count=1`)
         echo PREV_TAG=$(git describe --abbrev=0 --tags `git rev-list --tags --skip=1 --max-count=1`) >> $GITHUB_OUTPUT
          echo "prev tag is $PREV_TAG"
      - name: GET diff between TAGS
        id: git_diff
        if: $${{ steps.fetch_tag.outputs.PREV_TAG != '' }}
        run: echo GIT_DIFF=$(git diff --name-only ${{steps.fetch_tag.outputs.PREV_TAG}} ${{steps.fetch_tag.outputs.LATEST_TAG}} -- src/main/proto) >> $GITHUB_OUTPUT
      - name: Compare diff
        run: |
          if ${{steps.fetch_tag.outputs.PREV_TAG != ''}}  && ${{steps.git_diff.outputs.GIT_DIFF == ''}}; then
            echo "There is no difference in proto"
          else 
            echo "publish"
          fi

  
        
         
         
